[toc]

# 设施

又称建筑，是虫巢中的相对固定的单位，设施可以为虫巢提供各类加成，设施在被摧毁前会持续存在。种类很多，包括特定的洞穴区，使用材料修建的建筑物，虫群单位变成的活体设施，甚至菌毯一类的东西也算作设施。

## 属性

### 	对象属性

~~~
名称 : 字符串
数量 : 数字，该设施对象的数量
*等级 : 数字，可选，一部分设施对象可以通过升级以提升等级，其效果通常于等级数值有关
效果 : 字符串，描述该设施对象将会产生的效果
状态 : 状态数组，存放该设施对象当前的状态
特性 : 特性数组
词条 : 词条数组
信息 : 字符串，描述性的信息
所属 : 对象，该设施所归属的对象
~~~

### 	行为

~~~
获得 : 获得该设施时产生的效果，参数：facility(该设施)，target(获得该设施的对象)
效果 : 该设施被触发时，将要产生的效果，参数：facility(该设施),target(触发效果的对象)
结算 : 该设施在每回合结束时，产生的效果，参数：facility(该设施)
摧毁 : 该设施在被摧毁时，将要产生的效果，参数：facility(该设施)
加入需求 : 该设施在加入目标前，对目标对象进行的需求判定，返回bool，参数：facility(该设施),target(获得该设施的对象)
操作 : 行为对象字典，存放对应的key操作的功能函数，参数均为facility和target
~~~

### 功能

~~~
升级 : bool，默认为false
	为true时表示该设施可以被升级，要求存在对应的升级工作
拆除 : bool，默认为true
	为true时表示该设施可以被拆除，不要求存在对应的拆除工作，但可以用设定的拆除工作来覆盖默认的拆除工作
操作 : bool，默认为false，当对该设施的[行为→操作]不为空字典时，默认为true
	为true时表示该设施还有额外的操作可以选择进行
~~~

### 	词条

~~~
独一 : 该设施对象在同一虫巢中，同一时间只能存在一个，包括其被摧毁时可能留下的废墟
堆叠 : 重复获得相同key的设施对象，将会使其数量提升，而非
~~~

### 隐藏属性

**！请不要随意修改隐藏属性中的内容，大概率会引发错误！**

~~~
工作：存储与该设施有关的工作，不包括“建造”工作，这个属性中的数据会在创建设施对象时生成
{
	升级：工作对象数组，
	拆除：单个的工作对象
}
~~~



## 方法

### 	1.创建一个指名key的设施对象：createFacility(facility_key,source,num,states)

​		facility_key：指名设施对象的key
​		source：该设施对象的来源
​		*num：可选，该设施对象的数量
​		*states：可选，该设施对象拥有的额外属性

​		创建一个指名key的设施对象并返回
​		若num不为空，则设定该设施对象的数量为num

### 	2.创建一个指名key的设施对象的指名类工作对象：createFacilityWork( facility_key, work_key, work_source)

​		facilty_key：指名设施对象的key，如果传入一个设施对象则会获取其key
​		work_key：字符串或字符串数组，指名设施对象所持有的工作的key，可以将多层key放置在数组中，依次从lib中查询指定的json或func
​		work_source：该工作的创建来源

​		将会读取facility_work_lib中的数据生成设施的工作对象，这个工作对象的[功能→新增]将被设置为false，设施对象的工作需要以特殊的工作来开始
​		如果lib中不存在指名设施key或工作key，都会报错并返回false

### 	3.为虫巢解锁一个设施对象：unlockFacilityToBugNest(*facility_key*, *work_source*, *bugNest*)

​		facility_key：设施对象的key
​		work_source：解锁该建造工作的来源
​		bugNest：解锁该建造工作的虫巢单位

​		生成对应的facility_key设施对象的建造工作对象，并将其保存在bugNest对象的[已解锁→设施]当中，保存的形式为：{ facility_key : build_work（该建造工作对象）}

### 	4.令虫巢对象获得指定的设施对象：facilityJoinToBugNest(*facility*, *bugNest*) 

​		facility：加入虫巢的设施对象
​		bugNest：获得设施对象的虫巢
​		
​		将传入的设施对象添加进虫巢对象的[属性→设施→facility_key]数组中，相同key的设施对象会被放置在一起。
​		如果设施对象A拥有词条：[堆叠]，则获得时，会使得同key且也拥有[堆叠]词条的第一个设施对象B的数量上升该设施对象A的数量，增加来源就是这个设施对象A的来源，而不是获得这个设施对象A。

### 5.令一个设施对象的数量增加：addFacilityNum(*facility*,*source*,*num*,level)

​		facility：增加数量的设施对象
​		source：增加的来源
​		num：增加数值
​		*level：可选，优先级

​		向facility的[属性→数量]添加一个影响impact，优先级默认为0